# オンライン学習室

このプロジェクトは、リアルタイムで学習状況を共有できるオンライン学習室アプリケーションです。複数のユーザーが仮想的な学習室に参加し、各自の学習時間やステータス（集中中/休憩中）を共有できます。ルームの作成や参加も可能です。

## 機能

- **リアルタイム学習状況共有**: Socket.IO を使用して、ルーム内の全ユーザーの学習時間とステータス（集中中/休憩中）をリアルタイムで更新・表示します。
- **ルーム管理**: 新しい学習ルームを作成したり、既存のルームに参加したりできます。
- **個人タイマー**: 各ユーザーが自身の学習時間を計測できるタイマー機能を提供します。
- **tRPCによるAPI通信**: クライアントとサーバー間のAPI通信には tRPC を使用し、型安全なエンドツーエンドの通信を実現しています。
- **Fastifyサーバー**: 高速なNode.js Webフレームワークである Fastify をバックエンドに採用しています。
- **Reactフロントエンド**: ユーザーインターフェースは React で構築されており、Material-UI を使用してモダンなデザインを実現しています。

## 実装内容

### バックエンド (server/)

- **Fastify**: Webサーバーとして機能し、tRPCエンドポイントとSocket.IOサーバーをホストします。
- **Socket.IO**: リアルタイム通信を実現するためのライブラリです。ユーザーの接続、切断、ステータス更新などのイベントを処理し、ルーム内のユーザーにブロードキャストします。
- **tRPC**: 型安全なAPIを構築するためのフレームワークです。クライアントとサーバー間で共有される型定義に基づいて、APIエンドポイントを定義します。
- **ルーム管理ロジック**: `rooms.ts` でルームとユーザーの情報をメモリ上で管理し、`roomService.ts` でこれらの情報に対する操作（作成、参加、更新、削除など）をカプセル化しています。`index.ts` でSocket.IOイベントを処理し、`router.ts` でtRPCのエンドポイントを定義していますが、これらのファイルは直接 `rooms.ts` にアクセスせず、`roomService.ts` を介してルーム情報を操作します。

### フロントエンド (client/)

- **React**: UIを構築するためのJavaScriptライブラリです。
- **Material-UI**: Google の Material Design に基づいた React コンポーネントライブラリで、UIのスタイリングに使用しています。
- **Socket.IO Client**: バックエンドのSocket.IOサーバーと通信し、リアルタイムデータを受信・送信します。
- **React Query**: tRPC と組み合わせて、サーバーの状態管理とデータフェッチを効率的に行います。
- **個人タイマー**: `App.tsx` 内でタイマーのロジックと表示を実装しています。5秒ごとにサーバーに学習状況を送信します。

## セットアップ

### 前提条件

- Node.js (v18以上推奨)
- pnpm (パッケージマネージャー)

### インストール

1. リポジトリをクローンします。
   ```bash
   git clone https://github.com/your-username/online-study-room.git
   cd online-study-room
   ```

2. 依存関係をインストールします。
   ```bash
   pnpm install
   ```

   または、個別にインストールすることも可能です。

   ```bash
   cd server
   pnpm install
   cd ../client
   pnpm install
   cd ..
   ```

## 実行方法

### 開発モードで実行

1. **バックエンドサーバーの起動**
   `server` ディレクトリに移動し、開発サーバーを起動します。
   ```bash
   cd server
   pnpm dev
   ```
   サーバーは `http://localhost:3000` (tRPC) と `http://localhost:3001` (Socket.IO) でリッスンします。

2. **フロントエンドアプリケーションの起動**
   別のターミナルを開き、`client` ディレクトリに移動し、開発サーバーを起動します。
   ```bash
   cd client
   pnpm dev
   ```
   アプリケーションは `http://localhost:5173` で起動します。

### ビルドとプレビュー

1. **バックエンドのビルド**
   ```bash
   cd server
   pnpm build
   ```

2. **フロントエンドのビルド**
   ```bash
   cd client
   pnpm build
   ```

3. **バックエンドの起動 (ビルド後)**
   ```bash
   cd server
   pnpm start
   ```

4. **フロントエンドのプレビュー**
   ```bash
   cd client
   pnpm preview
   ```

## 使い方

1. アプリケーションにアクセスすると、Socket.IOの接続ステータスと自身のIDが表示されます。
2. 「新しいルーム名」を入力し、「ルームを作成」ボタンをクリックすると、新しい学習ルームが作成され、自動的にそのルームに参加します。
3. 既存のルームの「参加」ボタンをクリックすると、そのルームに参加できます。
4. ルームに参加すると、「個人タイマー」の「開始」ボタンが有効になります。
5. 「開始」ボタンをクリックするとタイマーが作動し、自身のステータスが「集中中」に変わります。ルーム内の他の参加者にもリアルタイムで学習状況が共有されます。
6. 「停止」ボタンをクリックするとタイマーが停止し、ステータスが「休憩中」に変わります。
7. 「参加者リスト」には、現在参加しているルームの全ユーザーのID、ステータス、学習時間が表示されます。
8. 「ルーム一覧」には、作成された全てのルームとその参加人数が表示されます。ルームの作成や参加によって、このリストもリアルタイムで更新されます。

## 開発者向け情報

- **tRPCエンドポイント**: `server/src/router.ts` で定義されています。
- **Socket.IOイベント**: `server/src/index.ts` で処理されています。
- **UIコンポーネント**: `client/src/App.tsx` に主なロジックとUIが記述されています。
- **テーマ設定**: `client/src/theme.ts` でMaterial-UIのテーマが設定されています。

## ライセンス

[MIT License](LICENSE) (必要であればLICENSEファイルを作成してください)
